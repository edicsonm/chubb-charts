apiVersion: apps/v1
kind: Deployment
metadata:
    name: {{.Values.server.name}}
    labels:
        workloadselector: deployment-{{.Values.server.name}}
spec:
    progressDeadlineSeconds: 600
    replicas: {{.Values.server.replicaCount}}
    revisionHistoryLimit: 10
    selector:
        matchLabels:
            workloadselector: deployment-{{.Values.server.name}}
    strategy:
        rollingUpdate:
            maxSurge: 1
            maxUnavailable: 0
        type: RollingUpdate
    template:
        metadata:
            labels:
                workloadselector: deployment-{{.Values.server.name}}
        spec:
            containers:
                image: entsia/eod:server_{{.Values.server.imageTag}}
                imagePullPolicy: Always
                name: {{.Values.server.name}}
                ports:
                    - containerPort: {{.Values.server.containerPort}}
                      name: {{.Values.server.containerPort}}tcp01
                      protocol: TCP
                readinessProbe:
                    failureThreshold: 3
                    httpGet:
                        path: /status
                        port: {{.Values.server.containerPort}}
                        scheme: HTTP
                    initialDelaySeconds: 120
                    periodSeconds: 10
                    successThreshold: 2
                    timeoutSeconds: 10
                resources: {}
                securityContext:
                    allowPrivilegeEscalation: false
                    privileged: false
                    readOnlyRootFilesystem: false
                    runAsNonRoot: false
                stdin: true
                terminationMessagePath: /dev/termination-log
                terminationMessagePolicy: File
                tty: true
                volumeMounts:
                    - mountPath: /opt/jboss/dd-java-agent.jar
                      name: vol1
                    - mountPath: /opt/jboss/wildfly/standalone/deployments/helo.war/WEB-INF/classes/secrets.properties
                      name: vol2
            dnsPolicy: ClusterFirst
            imagePullSecrets:
                - name: dockerhubentsia
            restartPolicy: Always
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
                - hostPath:
                      path: {{.Values.server.vol1Path}}
                      type: ""
                  name: vol1
                - hostPath:
                      path: {{.Values.server.vol2Path}}
                      type: ""
                  name: vol2
